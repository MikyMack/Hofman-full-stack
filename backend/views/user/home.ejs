<!DOCTYPE html>
<html lang="en">
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <title>Hofmaan | Home</title>

    <meta name="keywords" content="Hofmaan" />
    <meta name="description" content="Hofmaan">
    <meta name="author" content="Trivlogic">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/logo-2.png">

    <!-- WebFont.js -->
    <script>
        WebFontConfig = {
            google: { families: ['Poppins:400,500,600,700,800', 'Jost:400,500,600,700,800'] }
        };
        (function (d) {
            var wf = d.createElement('script'), s = d.scripts[0];
            wf.src = '/js/webfont.js';
            wf.async = true;
            s.parentNode.insertBefore(wf, s);
        })(document);
    </script>

    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-regular-400.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-solid-900.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-brands-400.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/fonts/wolmart87d5.ttf?png09e" as="font" type="font/ttf" crossorigin="anonymous">

    <!-- Vendor CSS -->
    <link rel="stylesheet" type="text/css" href="/vendor/fontawesome-free/css/all.min.css">

    <!-- Plugins CSS -->
    <link rel="stylesheet" type="text/css" href="/vendor/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" type="text/css" href="/vendor/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/vendor/magnific-popup/magnific-popup.min.css">

    <!-- Default CSS -->
    <link rel="stylesheet" type="text/css" href="/css/demo12.min.css">
    <link rel="stylesheet" type="text/css" href="/css/style.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        /* Highlight selected size */
        .size-option.active,
        .size-option.selected {
            background: #001F3F !important;
            color: #fff !important;
            border-color: #001F3F !important;
            box-shadow: 0 0 0 2px #a5d6a7;

        }

        .size-option {

            padding: 3px 6px 5px 6px;
            border: 1px solid #eff3f4 !important;

        }



        /* Highlight selected color */
        .color-option.active,
        .color-option.selected {
            border: 2px solid #001F3F !important;
            box-shadow: 0 0 0 2px #a5d6a7;
            outline: 2px solid #001F3F;
        }
    </style>
</head>

<body class="home">
    <div class="page-wrapper">
        <h1 class="d-none">Hofmaan | Home</h1>
        <!-- Start of Header -->
        <header class="header">
            <div class="header-top">
                <div class="container">
                    <div class="header-top-left">
                        <p class="hofmaan-marquee-msg">
                            <span class="hofmaan-marquee-content">
                                <% if (activeCoupons && activeCoupons.length) { %>
                                    <% activeCoupons.forEach(function(coupon) { %>
                                        <%= coupon.description %> &nbsp;&nbsp;&nbsp; •
                                            &nbsp;&nbsp;&nbsp;
                                            <% }); %>
                                                <% } else { %>
                                                    Welcome to Hofmaan Store! Offers Available
                                                    <% } %>
                            </span>
                        </p>
                    </div>


                    <div class="header-right">
                        <span class="divider d-lg-show"></span>
                        <a href="/store" class="d-lg-show">Store</a>
                        <a href="/about" class="d-lg-show">About Us</a>
                        <a href="/contact" class="d-lg-show">Contact Us</a>
                        <% if (user) { %>
                            <a href="/account" class="d-lg-show"><i class="w-icon-account"></i>Profile</a>
                            <span class="delimiter d-lg-show">/</span>
                            <a href="/orders" class="ml-0 d-lg-show">My Orders</a>
                            <% } else { %>
                                <a href="/auth/login" class="d-lg-show"><i class="w-icon-account"></i>Sign In</a>
                                <span class="delimiter d-lg-show">/</span>
                                <a href="/auth/login" class="ml-0 d-lg-show">Register</a>
                                <% } %>
                    </div>
                </div>
            </div>
            <!-- End of Header Top -->
            <div class="header-middle sticky-content fix-top sticky-header border-no">
                <div class="container">
                    <div class="header-left mr-md-4">
                        <a href="#" class="mobile-menu-toggle  w-icon-hamburger"></a>
                        <a href="/" class="logo">
                            <img src="/images/logo.png" alt="logo" width="200">
                        </a>
                       
                        <form class="input-wrapper header-search hs-expanded hs-round d-none d-md-flex" id="searchForm" style="position:relative;">
                            <div class="custom-search-bar w-100">
                                <input type="text" class="form-control" name="q" id="searchInput"
                                    placeholder="Search for products..." autocomplete="off" />

                                <script>
                                    // Typing animation for placeholder
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const searchInput = document.getElementById('searchInput');
                                        const placeholders = [
                                            "Search for products...",
                                            "Search by categories...",
                                            "Search for loafers...",
                                            "Search for sandals...",
                                            "Search for bags...",
                                            "Search for formal Shoes...",
                                            "Search for clogs..."
                                        ];
                                        let current = 0;
                                        let charIndex = 0;
                                        let typing = true;

                                        function typePlaceholder() {
                                            const text = placeholders[current];
                                            if (typing) {
                                                if (charIndex < text.length) {
                                                    searchInput.setAttribute('placeholder', text.substring(0, charIndex + 1));
                                                    charIndex++;
                                                    setTimeout(typePlaceholder, 60);
                                                } else {
                                                    typing = false;
                                                    setTimeout(typePlaceholder, 1200);
                                                }
                                            } else {
                                                if (charIndex > 0) {
                                                    searchInput.setAttribute('placeholder', text.substring(0, charIndex - 1));
                                                    charIndex--;
                                                    setTimeout(typePlaceholder, 30);
                                                } else {
                                                    typing = true;
                                                    current = (current + 1) % placeholders.length;
                                                    setTimeout(typePlaceholder, 400);
                                                }
                                            }
                                        }

                                        // Only animate if input is not focused
                                        let animating = true;
                                        searchInput.addEventListener('focus', () => {
                                            animating = false;
                                            searchInput.setAttribute('placeholder', placeholders[current]);
                                        });
                                        searchInput.addEventListener('blur', () => {
                                            if (!animating) {
                                                animating = true;
                                                charIndex = 0;
                                                typing = true;
                                                typePlaceholder();
                                            }
                                        });

                                        typePlaceholder();
                                    });
                                </script>
                                <button class="btn btn-search" type="submit" aria-label="Search">
                                    <i class="w-icon-search"></i>
                                </button>
                            </div>
                            <div id="searchSuggestions" class="search-suggestions"></div>
                        </form>
                        <div id="searchResults" class="search-results-container"></div>

                    </div>
                    <div class="header-right ml-4">
                        <div class="header-call d-xs-show d-lg-flex align-items-center">
                            <a href="tel:+919400947122" class="w-icon-call"></a>
                            <div class="call-info d-lg-show">
                                <h4 class="chat font-size-md text-normal ls-normal text-white mb-0">
                                    <a href="tel:+919400947122" class="text-capitalize text-primary font-weight-normal">Customer care</a>
                                </h4>
                                <a href="tel:+919400947122" class="phone-number font-weight-bolder ls-50">+91 9400947122</a>
                            </div>
                        </div>
                        <a class="wishlist label-down link d-xs-show" href="/wishlist">
                            <i class="w-icon-heart"></i>
                            <span class="wishlist-label d-lg-show">Wishlist</span>
                        </a>
                        <div class="dropdown cart-dropdown cart-offcanvas mr-0 mr-lg-2">
                            <div class="cart-overlay"></div>
                            <a href="/cart" class="cart-toggle label-down link">
                                <i class="w-icon-cart">
                                    <span class="cart-count text-white">
                                        <% if (user) { %>
                                            <%= cartItems && cartItems.length ? cartItems.length : " " %>
                                                <% } else { %>
                                                    <span id="guest-cart-count"></span>
                                                    <script>
                                                        document.addEventListener('DOMContentLoaded', function () {
                                                            var guestCartCount = document.getElementById('guest-cart-count');
                                                            var guestCart = localStorage.getItem('guestCart');
                                                            var count = 0;
                                                            if (guestCart) {
                                                                try {
                                                                    var cartArr = JSON.parse(guestCart);
                                                                    if (Array.isArray(cartArr)) {
                                                                        count = cartArr.length;
                                                                    }
                                                                } catch (e) { }
                                                            }
                                                            guestCartCount.textContent = count > 0 ? count : " ";
                                                        });
                                                    </script>
                                                    <% } %>
                                    </span>
                                </i>
                                <span class="cart-label">Cart</span>
                            </a>
                            <div class="dropdown-box">
                                <div class="cart-header">
                                    <span>Shopping Cart</span>
                                    <a href="#" class="btn-close">Close<i class="w-icon-long-arrow-right"></i></a>
                                </div>
                                <div class="products" id="cart-products-list">
                                    <% if (user && cartItems && cartItems.length> 0) { %>
                                        <% cartItems.slice(0, 6).forEach(function(item) { %>
                                            <div class="product product-cart">
                                                <div class="product-detail">
                                                    <a href="/product/<%= item.product %>" class="product-name">
                                                        <%= item.productName %>
                                                    </a>
                                                    <div class="price-box">
                                                        <span class="product-quantity">
                                                            <%= item.quantity %>
                                                        </span>
                                                        <span class="product-price ml-2">
                                                            ₹<%= item.price ? item.price.toFixed(2) : '0.00' %>
                                                        </span>
                                                    </div>
                                                </div>
                                                <figure class="product-media">
                                                    <img src="<%= item.productImage %>" alt="product" height="84"
                                                        width="94">
                                                </figure>
                                            </div>
                                            <% }); %>
                                                <% } else if (!user) { %>
                                                    <!-- Guest cart will be rendered by JS -->
                                                    <% } else { %>
                                                        <div class="text-center py-5 mt-4 ">
                                                            <span class="mt-5">Your cart is empty.</span>
                                                        </div>
                                                        <% } %>
                                </div>

                                <div class="cart-total" id="cart-subtotal-section">
                                    <label>Subtotal:</label>
                                    <span class="price" id="cart-subtotal-amount">
                                        ₹<%= user && typeof cartSubtotal==='number' ? cartSubtotal.toFixed(2) : '0.00'
                                            %>
                                    </span>
                                </div>
                                <div class="cart-action">
                                    <a href="/cart" class="btn btn-dark btn-outline btn-rounded">View Cart</a>
                                    <% if (user) { %>
                                        <a href="/checkout" class="btn btn-primary btn-rounded">Checkout</a>
                                    <% } else { %>
                                        <a href="/auth/login" class="btn btn-primary btn-rounded">Login</a>
                                    <% } %>
                                </div>
                            </div>
                            <% if (!user) { %>
                                <script>
                                    // Guest cart rendering for non-logged-in users
                                    function renderGuestCart() {
                                        const cartProductsList = document.getElementById('cart-products-list');
                                        const subtotalSection = document.getElementById('cart-subtotal-amount');
                                        let guestCart = localStorage.getItem('guestCart');
                                        if (!guestCart) {
                                            cartProductsList.innerHTML = '<div class="text-center py-3"><span>Your cart is empty.</span></div>';
                                            subtotalSection.textContent = '₹0.00';
                                            return;
                                        }
                                        try {
                                            guestCart = JSON.parse(guestCart);
                                        } catch (e) {
                                            cartProductsList.innerHTML = '<div class="text-center py-3"><span>Your cart is empty.</span></div>';
                                            subtotalSection.textContent = '₹0.00';
                                            return;
                                        }
                                        // guestCart is now an array of cart items
                                        if (!Array.isArray(guestCart) || guestCart.length === 0) {
                                            cartProductsList.innerHTML = '<div class="text-center py-3"><span>Your cart is empty.</span></div>';
                                            subtotalSection.textContent = '₹0.00';
                                            return;
                                        }
                                        let html = '';
                                        let subtotal = 0;
                                        guestCart.forEach(function (item) {
                                            subtotal += (item.price || 0) * (item.quantity || 1);
                                            html += `
                                            <div class="product product-cart">
                                                <div class="product-detail">
                                                    <a href="/product/${item.productId}" class="product-name">
                                                        ${item.productName || ''}
                                                    </a>
                                                    <div class="price-box">
                                                        <span class="product-quantity">
                                                            ${item.quantity || 1}
                                                        </span>
                                                        <span class="product-price ml-2">
                                                            ₹${item.price ? Number(item.price).toFixed(2) : '0.00'}
                                                        </span>
                                                   </div>
                                                </div>
                                                <figure class="product-media">
                                                    <img src="${item.productImage || ''}" alt="product" height="84" width="94">
                                                </figure>
                                            </div>
                                        `;
                                        });
                                        cartProductsList.innerHTML = html;
                                        subtotalSection.textContent = '₹' + subtotal.toFixed(2);
                                    }
                                    document.addEventListener('DOMContentLoaded', renderGuestCart);
                                </script>
                                <% } %>
                                    <!-- End of Dropdown Box -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of Header Middle -->
        </header>
        <!-- End of Header -->
        <!-- Start of Main -->
        <main class="main">
            <div class=" pb-2">
                <div class="category-wrapper pt-4">
                    <% categories.forEach(category=> { %>
                        <div class="category text-center py-2 px-3 dropdown">
                            <h4 class="category-name">
                                <a href="/store?category=<%= category._id %>">
                                    <%= category.name %>
                                </a>
                            </h4>

                            <% if (category.subCategories && category.subCategories.length> 0) { %>
                                <div class="subcategory-dropdown enhanced-submenu">
                                    <% category.subCategories.forEach(sub=> { %>
                                        <% if (sub.isActive) { %>
                                            <a href="/store?subcategory=<%= sub._id %>">
                                                <%= sub.name %>
                                            </a>
                                            <% } %>
                                                <% }) %>
                                </div>
                                <% } %>
                        </div>
                        <% }) %>
                </div>


                <!-- Main Banner Full Width -->
                <div class="intro-section mb-2">
                    <div class="row">
                        <div class="col-12 mt-4 mb-4">
                            <div class="swiper-container swiper-theme pg-inner pg-white animation-slider"
                                data-swiper-options="{
                                    'spaceBetween': 0,
                                    'slidesPerView': 1,
                                    'autoplay': {
                                        'delay': 4500,
                                        'disableOnInteraction': false
                                    },
                                    'loop': true,
                                    'effect': 'fade',
                                    'fadeEffect': { 'crossFade': true },
                                    'speed': 1500
                                }">
                                <div class="swiper-wrapper row gutter-no cols-1">
                                    <% if (mainBanner && mainBanner.length> 0) { %>
                                        <% mainBanner.forEach((banner, index)=> { %>
                                            <div class="swiper-slide banner banner-fixed intro-slide br-sm"
                                                style="background-image: url(<%= banner.image %>); background-color: #EAEAEA; position: relative; height: 400px; background-size: cover; background-position: center;">
                                                <div class="main-banner-content-wrapper" style="
                                                        position: absolute;
                                                        top: 50%;
                                                        transform: translateY(-50%);
                                                        width: 100%;
                                                        padding: 0 60px;
                                                        display: flex;
                                                        justify-content: <%= index % 2 === 0 ? 'flex-start' : 'flex-end' %>;
                                                    ">
                                                    <div class="banner-content text-<%= index % 2 === 0 ? 'left' : 'right' %>"
                                                        style="max-width: 600px;">
                                                        <% if (banner.subtitle) { %>
                                                            <h3 class="banner-subtitle text-uppercase font-secondary font-weight-bolder slide-animate text-black"
                                                                data-animation-options="{'name': 'fadeInLeftShorter', 'duration': '.5s', 'delay': '.2s'}">
                                                                <%= banner.subtitle %>
                                                            </h3>
                                                            <% } %>
                                                                <% if (banner.title) { %>
                                                                    <h2 class="banner-title font-secondary text-capitalize text-black slide-animate"
                                                                        data-animation-options="{'name': 'fadeInRightShorter', 'duration': '.5s', 'delay': '.4s'}">
                                                                        <%= banner.title %>
                                                                    </h2>
                                                                    <% } %>
                                                                        <% if (banner.description) { %>
                                                                            <h4 class="banner-price-info font-weight-normal text-black ls-25 slide-animate"
                                                                                data-animation-options="{'name': 'fadeInRightShorter', 'duration': '.5s', 'delay': '.4s'}">
                                                                                <% const
                                                                                    words=banner.description.split(' ');
                                                                    if (words.length > 6) {
                                                                        const firstSix = words.slice(0, 6).join(' ');
                                                                        const rest = words.slice(6).join(' ');
                                                                %>
                                                                    <%= firstSix %><br><%= rest %>
                                                                <% 
                                                                    } else { 
                                                                %>
                                                                    <%= banner.description %>
                                                                <% 
                                                                    }
                                                                %>
                                                            </h4>
                                                        <% } %>
                                                        <% if (banner.link) { %>
                                                            <a href="<%= banner.link %>"
                                                                class="btn btn-outline btn-black bnr-btn btn-rounded btn-icon-right slide-animate"
                                                                data-animation-options="{' name': 'fadeInUpShorter'
                                                                                    , 'duration' : '.5s' , 'delay'
                                                                                    : '.6s' }">
                                                                                    Shop Now
                                                                                    <i
                                                                                        class="w-icon-long-arrow-right"></i>
                                                                                    </a>
                                                                                    <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }) %>
                                                <% } %>
                                </div>
                                <div class="swiper-pagination"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Banner Two Row Below Main Banner -->
                <div class=" container intro-banner-row mb-2">
                    <div class="row">
                        <% if (bannerTwo && bannerTwo.length> 0) { %>
                            <% bannerTwo.forEach((banner, index)=> { %>
                                <div class="col-lg-6 col-md-6 col-12 mb-4">
                                    <div
                                        class="banner banner-fixed intro-banner<%= index === 1 ? ' intro-banner2' : '' %> br-sm h-100">
                                        <figure class="br-sm">
                                            <img src="<%= banner.image %>" alt="Category Banner" width="680"
                                                height="180"
                                                style="background-color: #565960; object-fit: cover; width: 100%;" />
                                        </figure>
                                        <!-- <div class="banner-content">
                                            <% if (banner.subtitle) { %>
                                                <h5
                                                    class="banner-subtitle text-uppercase font-weight-bold <%= index === 1 ? 'text-default' : 'text-lighter' %>">
                                                    <%= banner.subtitle %>
                                                </h5>
                                                <% } %>
                                                    <% if (banner.title) { %>
                                                        <h3
                                                            class="banner-title font-secondary font-weight-bolder ls-25 <%= index === 1 ? 'text-dark' : 'text-white' %>">
                                                            <%= banner.title %>
                                                        </h3>
                                                        <% } %>
                                                            <% if (banner.link) { %>
                                                                <a href="<%= banner.link %>"
                                                                    class="btn <%= index === 1 ? 'btn-dark' : 'btn-white' %> btn-link btn-slide-right btn-icon-right btn-infinite">
                                                                    Shop Now
                                                                    <i class="w-icon-long-arrow-right"></i>
                                                                </a>
                                                                <% } %>
                                        </div> -->
                                    </div>
                                </div>
                                <% }) %>
                                    <% } %>
                    </div>
                </div>
                <!-- End of Intro-wrapper -->
                <div class="py-4 container">
                    <p class="mb-3 text-center font-weight-bolder" style="letter-spacing:1px; font-size: larger; color: #001F3F;">
                        <strong>BRANDS</strong>
                    </p>
                    <div class="row justify-content-center align-items-center w-100 mx-0">
                        <div class="col-6 col-sm-4 col-md-3 d-flex justify-content-center mb-3 mb-md-0">
                            <img src="/images/hofmaan/blackDuck.jpg" alt="Hofmaan Logo" class="img-fluid"
                                style="max-height:150px; width:150px;">

                        </div>
                        <div class="col-6 col-sm-4 col-md-3 d-flex justify-content-center">
                            <img src="/images/logo-2.png" alt="Blackbuck Logo" class="img-fluid"
                                style="max-height:150px; width:150px;">

                        </div>
                    </div>
                </div>
                <div class="swiper-container container  swiper-theme icon-box-wrapper br-sm mt-0 mb-10 appear-animate"
                    data-swiper-options="{
                'slidesPerView': 1,
                'breakpoints': {
                    '576': {
                        'slidesPerView': 2
                    },
                    '992': {
                        'slidesPerView': 3
                    },
                    '1200': {
                        'slidesPerView': 4
                    }
                }}">

                    <!-- End of Iocn Box Wrapper -->

                    <div class="title-link-wrapper title-select after-none appear-animate">
                        <h2 class="title font-secondary font-weight-bolder">Best Deals</h2>
                        <a href="/store" class="font-weight-bold ls-25">
                            All Products
                            <i class="w-icon-long-arrow-right"></i>
                        </a>
                    </div>
                    <div class="swiper-container swiper-theme select-product-wrapper shadow-swiper appear-animate pb-2 mb-10"
                        data-swiper-options='{
                "spaceBetween": 20,
                "slidesPerView": 1.1,
                "breakpoints": {
                    "768": { "slidesPerView": 3 },
                    "992": { "slidesPerView": 4 },
                    "1200": { "slidesPerView": 4 }
                }
            }'>
                        <div class="swiper-wrapper row cols-lg-5 cols-md-4 cols-sm-3 cols-2">
                            <% bestDeals.forEach(product=> { %>
                                <div class="swiper-slide product product-image-gap product-simple"
                                    data-product-id="<%= product._id %>"
                                    data-has-color="<%= product.hasColorVariants %>"
                                    data-has-size="<%= product.hasSizeVariants %>"
                                    data-product-name="<%= product.name.replace(/" /g, '&quot;' ) %>"
                                    data-product-image="<%= product.images[0] %>"
                                        data-product-price="<%= product.salePrice || product.basePrice %>">

                                            <figure class="product-media">
                                                <a href="/product/<%= product._id %>">
                                                    <img src="<%= product.images[0] %>" alt="Product" width="295"
                                                        height="335" loading="lazy" />
                                                    <% if (product.images[1]) { %>
                                                        <img src="<%= product.images[1] %>" alt="Product" width="295"
                                                            height="335" loading="lazy" />
                                                        <% } %>
                                                </a>
                                            </figure>

                                            <div class="product-details">
                                                <div class="wish-btn">


                                                    <% if (user) { %>
                                                        <a href="#" class="btn-wishlist wish-btn w-icon-heart"
                                                            data-product-id="<%= product._id %>" title="Add to wishlist"
                                                            onclick="event.preventDefault(); addTooWishlist('<%= product._id %>', this);">
                                                        </a>
                                                        <% } else { %>
                                                            <a href="/auth/login" class="btn-wishlist w-icon-heart"
                                                                title="Login to add to wishlist">
                                                            </a>
                                                            <% } %>
                                                                <h4 class="product-name">
                                                                    <a href="/product/<%= product._id %>">
                                                                        <%= product.name %>
                                                                    </a>
                                                                </h4>
                                                </div>

                                                <div class="product-variations product-det flex flex-wrap mb-2">
                                                    <% if (product.hasSizeVariants) { %>
                                                        <div class="product-size  mr-3 d-flex align-items-center">
                                                            <span class="font-weight-bold mr-1">Size:</span>
                                                            <div class="prd-size">
                                                                <% product.sizeVariants.forEach(size=> { %>
                                                                    <span
                                                                        class="size-option pr-size badge badge-light border px-2 py-1 mr-1"
                                                                        data-size="<%= size.size %>"
                                                                        data-stock="<%= size.stock %>"
                                                                        style="cursor:pointer;">
                                                                        <%= size.size %>
                                                                    </span>
                                                                    <% }) %>
                                                            </div>
                                                        </div>
                                                        <% } %>

                                                            <% if (product.hasColorVariants) { %>
                                                                <div class="product-color">
                                                                    <span class="font-weight-bold mr-1"> Color</span>
                                                                    <% product.colorVariants.forEach(color=>
                                                                        { %>
                                                                        <span
                                                                            class="color-option border rounded-circle d-inline-block mr-1 mb-1"
                                                                            data-color="<%= color.color %>"
                                                                            data-stock="<%= color.stock %>"
                                                                            title="<%= color.color %>"
                                                                            style="width:22px;height:22px;vertical-align:middle;cursor:pointer;background:<%= color.color %>;border:2px solid #eee;display:inline-block;">
                                                                        </span>
                                                                        <% }) %>
                                                                </div>
                                                                <% } %>
                                                </div>

                                                <div class="selected-variant-info"
                                                    style="min-height:24px;font-size:0.95em;color:#444;">
                                                    <!-- Will be filled by JS -->
                                                </div>

                                                <div class="product-pa-wrapper">
                                                    <div class="product-price">
                                                        <ins class="new-price">₹<%= product.salePrice || product.basePrice %></ins>
                                                        <% if (product.salePrice && product.salePrice != product.basePrice) { %>
                                                            <del class="old-price">₹<%= product.basePrice %></del>
                                                        <% } %>
                                                    </div>
                                                    <div class="product-action">
                                                        <button
                                                            class="btn-cart btn-product btn btn-link btn-underline add-to-cart-btn1"
                                                            data-product-id="<%= product._id %>"
                                                            data-has-color="<%= product.hasColorVariants %>"
                                                            data-has-size="<%= product.hasSizeVariants %>"
                                                            data-product-name="<%= product.name.replace(/" /g, '&quot;'
                                                            ) %>"
                                                            data-product-image="<%= product.images[0] %>"
                                                                data-product-price="<%= product.salePrice ||
                                                                    product.basePrice %>">
                                                                    Add To Cart
                                                        </button>

                                                    </div>
                                                </div>
                                            </div>
                                </div>
                                <% }) %>
                        </div>


                        <div class="swiper-pagination mt-4"></div>
                    </div>

                    <!-- End of Selected Products Wrapper -->

                    <div class="banner-wrapper appear-animate row cols-md-2 mb-7">
                        <% if (bannerThree && bannerThree.length> 0) { %>
                            <% bannerThree.slice(0, 2).forEach((banner, index)=> { %>
                                <div class="banner banner-fixed overlay-dark br-sm mt-4">
                                    <figure class="br-sm">
                                        <img src="<%= banner.image %>" alt="Category Banner" width="680" height="180"
                                            style="background-color: <%= index === 1 ? '#E5E6E8' : '#565960' %>; object-fit: cover;"
                                            loading="lazy" />
                                    </figure>
                                    <!-- <div class="banner-content y-50">
                                        <% if (banner.description) { %>
                                            <h4
                                                class="banner-price-info font-secondary font-weight-normal mb-0 <%= index === 1 ? 'text-default' : 'text-lighter' %>">
                                                <%= banner.description %>
                                            </h4>
                                            <% } %>
                                                <% if (banner.title) { %>
                                                    <h2
                                                        class="banner-title font-secondary <%= index === 1 ? 'text-dark' : 'text-white' %>">
                                                        <%= banner.title %>
                                                    </h2>
                                                    <% } %>
                                                        <% if (banner.subtitle) { %>
                                                            <h3
                                                                class="banner-subtitle font-weight-normal <%= index === 1 ? 'text-default' : 'text-lighter' %>">
                                                                <%= banner.subtitle %>
                                                            </h3>
                                                            <% } %>
                                                                <% if (banner.link) { %>
                                                                    <a href="<%= banner.link %>"
                                                                        class="btn btn-sm btn-outline <%= index === 1 ? 'btn-dark' : 'btn-white' %> btn-rounded btn-icon-right slide-animate">
                                                                        Shop Now
                                                                        <i class="w-icon-long-arrow-right"></i>
                                                                    </a>
                                                                    <% } %>
                                    </div> -->
                                </div>
                                <% }) %>
                                    <% } %>
                    </div>

                    <!-- End of Banner-wrapper -->

                    <div class="title-link-wrapper title-deals after-none appear-animate">
                        <h2 class="title font-secondary mb-1">Deals Of The Day</h2>
                        <a href="/store" class="font-weight-bold ls-25">
                            More Products
                            <i class="w-icon-long-arrow-right"></i>
                        </a>
                    </div>
                    <div class="swiper-container swiper-theme mb-4 pg-inner animation-slider" data-swiper-options='{
                "spaceBetween": 20,
                "slidesPerView": 1,
                "breakpoints": {
                    "992": {
                        "slidesPerView": 2
                    }
                }
            }'>
                        <div class="swiper-wrapper row cols-lg-2">
                            <% dealsOfTheDay.forEach(product=> { %>
                                <div class="swiper-slide product product-list br-sm mb-2"
                                    data-product-id="<%= product._id %>"
                                    data-has-color="<%= !!(product.colorVariants && product.colorVariants.length) %>"
                                    data-has-size="<%= !!(product.sizeVariants && product.sizeVariants.length) %>"
                                    data-product-name="<%= product.name.replace(/" /g, '&quot;' ) %>"
                                    data-product-image="<%= product.images[0] %>"
                                        data-product-price="<%= product.salePrice || product.basePrice %>">
                                            <figure class="product-media">
                                                <a href="/product/<%= product._id %>">
                                                    <img src="<%= product.images[0] %>" alt="Product Image" width="315"
                                                        height="355" loading="lazy">
                                                    <% if (product.images[1]) { %>
                                                        <img src="<%= product.images[1] %>" alt="Product Image"
                                                            width="315" height="355" loading="lazy">
                                                        <% } %>
                                                </a>
                                            </figure>
                                            <div class="product-details">
                                                <h4 class="product-name">
                                                    <a href="/product/<%= product._id %>">
                                                        <%= product.name %>
                                                    </a>
                                                </h4>
                                                <div class="product-variations flex flex-wrap justify-content-start">
                                                    <% if (product.sizeVariants && product.sizeVariants.length) { %>
                                                        <div class="product-size mr-3 d-flex align-items-center">
                                                            <span class="font-weight-bold mr-1">Size:</span>
                                                            <div>
                                                                <% product.sizeVariants.forEach(size=> { %>
                                                                    <span
                                                                        class="size-option badge  badge-light border px-2 py-1 mr-1"
                                                                        data-size="<%= size.size %>"
                                                                        data-stock="<%= size.stock %>"
                                                                        style="cursor:pointer;">
                                                                        <%= size.size %>
                                                                    </span>
                                                                    <% }) %>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                            <% if (product.colorVariants &&
                                                                product.colorVariants.length) { %>
                                                                <div class="product-color">
                                                                    <span class="font-weight-bold mr-1"></span>
                                                                    <% product.colorVariants.forEach(color=> { %>
                                                                        <span
                                                                            class="color-option border rounded-circle d-inline-block mr-1 mb-1"
                                                                            data-color="<%= color.color %>"
                                                                            data-stock="<%= color.stock %>"
                                                                            title="<%= color.color %>"
                                                                            style="width:22px;height:22px;vertical-align:middle;cursor:pointer;background:<%= color.color %>;border:2px solid #eee;display:inline-block;">
                                                                        </span>
                                                                        <% }) %>
                                                                </div>
                                                                <% } %>
                                                </div>

                                                <div class="product-price">
                                                    <ins class="new-price">₹<%= product.salePrice || product.basePrice
                                                            %>
                                                    </ins>
                                                    <% if (product.salePrice) { %>
                                                        <del class="old-price">₹<%= product.basePrice %></del>
                                                        <% } %>
                                                </div>
                                                <p class="text-default">
                                                    <%= product.description.substring(0, 50) %>...
                                                </p>
                                                <div class="product-action  hm-pr-btn">
                                                    <button
                                                        class="btn-cart btn-product btn btn-link btn-underline add-to-cart-btn1"
                                                        data-product-id="<%= product._id %>"
                                                        data-has-color="<%= !!(product.colorVariants && product.colorVariants.length) %>"
                                                        data-has-size="<%= !!(product.sizeVariants && product.sizeVariants.length) %>"
                                                        data-product-name="<%= product.name.replace(/" /g, '&quot;' )
                                                        %>"
                                                        data-product-image="<%= product.images[0] %>"
                                                            data-product-price="<%= product.salePrice ||
                                                                product.basePrice %>">
                                                                <i class="w-icon-cart"></i>
                                                                <span>Add to cart</span>
                                                    </button>
                                                    <% if (user) { %>
                                                        <a href="#" class="btn-wishlist w-icon-heart ml-4"
                                                            data-product-id="<%= product._id %>" title="Add to wishlist"
                                                            onclick="event.preventDefault(); addTooWishlist('<%= product._id %>', this);">
                                                        </a>
                                                        <% } else { %>
                                                            <a href="/auth/login" class="btn-wishlist w-icon-heart"
                                                                title="Login to add to wishlist">
                                                            </a>
                                                            <% } %>
                                                </div>
                                            </div>
                                </div>
                                <% }); %>
                        </div>
                    </div>

                    <!-- End of Swiper -->

                    <div class="swiper-container swiper-theme mb-8 pg-inner animation-slider" data-swiper-options='{
                "spaceBetween": 20,
                "slidesPerView": 2,
                "breakpoints": {
                    "576": { "slidesPerView": 2 },
                    "768": { "slidesPerView": 3 },
                    "992": { "slidesPerView": 4 }
                }
            }'>
                        <div class="swiper-wrapper row cols-xl-4 cols-lg-3 cols-sm-2 cols-1">
                            <% allProducts.forEach(product=> { %>
                                <div class="swiper-slide">
                                    <div class="product-widget-wrap">
                                        <div style="display: flex; flex-wrap: wrap;" class="product product-widget">
                                            <figure class="product-media">
                                                <a href="/product/<%= product._id %>">
                                                    <img src="<%= product.images[0] || '/images/default.jpg' %>"
                                                        alt="Product" width="100" height="106">
                                                    <% if (product.images.length> 1) { %>
                                                        <img src="<%= product.images[1] %>" alt="Product" width="100"
                                                            height="106">
                                                        <% } %>
                                                </a>
                                            </figure>
                                            <div class="product-details">
                                                <h4 class="product-name">
                                                    <a href="/product/<%= product._id %>">
                                                        <%= product.name %>
                                                    </a>
                                                </h4>
                                                <div class="product-price">
                                                    <ins class="new-price">₹<%= product.salePrice || product.basePrice
                                                            %>
                                                    </ins>
                                                    <% if (product.salePrice && product.salePrice < product.basePrice) {
                                                        %>
                                                        <del class="old-price">₹<%= product.basePrice %></del>
                                                        <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                    </div>

                    <!-- End of Swiper -->
                </div>

                <div class="banner banner-fixed purchase-banner appear-animate">
                    <figure class="banner-img">
                        <img src="/images/demos/demo12/banner/banner-5.jpg" alt="Banner" width="680" height="180"
                            style="background-color: #342E30;" />
                    </figure>
                    <div class="banner-content text-center x-50 y-50 slide-animate"
                        data-animation-options="{'name': 'fadeInLeftShorter', 'duration': '15s', 'delay': '3s'}">
                        <h3 class="banner-subtitle text-white text-uppercase font-secondary font-weight-bold">Welcome To Hofmaan Store 🛍️</h3>
                        <h2 class="banner-title text-white font-secondary font-weight-bolder mb-2">" Born In India , Worn Everywhere "</h2>
                        <p class="text-lighter font-weight-normal">
                            Free shipping for all orders
                        </p>
                        <a href="/store" class="btn btn-lg btn-outline btn-white btn-rounded btn-icon-right slide-animate">
                            Purchase Now
                            <i class="w-icon-long-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- End of Banner -->
                <div class="container">
                    <h2
                        class="title title-latest-product font-secondary font-weight-bolder justify-content-center ls-normal mt-10 mb-2 pt-1 appear-animate">
                        All Products
                    </h2>
                    <div class="tab tab-latest-product tab-nav-center tab-nav-underline tab-line-grow appear-animate">
                        <ul class="nav nav-tabs bb-no justify-content-center" role="tablist">
                            <li class="nav-item mb-2">
                                <a class="nav-link active ls-normal" href="#tab1-1"
                                    data-container="all-products-container" data-type="all">All Products</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link ls-normal" href="#tab1-2" data-container="best-deals-container"
                                    data-type="best-deals">Best Deals</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link ls-normal" href="#tab1-3" data-container="new-arrivals-container"
                                    data-type="new-arrivals">New Arrivals</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link ls-normal" href="#tab1-4" data-container="best-seller-container"
                                    data-type="best-seller">Best Seller</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link ls-normal" href="#tab1-5" data-container="top-rated-container"
                                    data-type="top-rated">Top Rated</a>
                            </li>
                        </ul>
                    </div>
                    <!-- End of Tab -->
                    <div class="tab-content product-wrapper appear-animate">
                        <!-- All Products Tab -->
                        <div class="tab-pane active" id="tab1-1">
                            <div class="swiper-container swiper-theme latest-product-wrapper shadow-swiper appear-animate mb-0"
                                data-swiper-options="{
                          'spaceBetween': 10,
                          'slidesPerView': 1.1,
                          'breakpoints': {
                            '576': { 'slidesPerView': 2 },
                            '768': { 'slidesPerView': 3 },
                            '992': { 'slidesPerView': 4 },
                            '1200': { 'slidesPerView': 4 }
                          }
                        }">
                                <div class="swiper-wrapper row cols-lg-5 cols-md-4 cols-sm-3 cols-2"
                                    id="all-products-container">
                                    <!-- Products will be loaded here dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Best Deals Tab -->
                        <div class="tab-pane" id="tab1-2">
                            <div class="swiper-container swiper-theme latest-product-wrapper shadow-swiper appear-animate mb-0"
                                data-swiper-options="{
                          'spaceBetween': 10,
                          'slidesPerView': 1.1,
                          'breakpoints': {
                            '576': { 'slidesPerView': 2 },
                            '768': { 'slidesPerView': 3 },
                            '992': { 'slidesPerView': 4 },
                            '1200': { 'slidesPerView': 4 }
                          }
                        }">
                                <div class="swiper-wrapper row cols-lg-5 cols-md-4 cols-sm-3 cols-2"
                                    id="best-deals-container">
                                    <!-- Products will be loaded here dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- New Arrivals Tab -->
                        <div class="tab-pane" id="tab1-3">
                            <div class="swiper-container swiper-theme latest-product-wrapper shadow-swiper appear-animate mb-0"
                                data-swiper-options="{
                          'spaceBetween': 10,
                          'slidesPerView': 1.1,
                          'breakpoints': {
                            '576': { 'slidesPerView': 2 },
                            '768': { 'slidesPerView': 3 },
                            '992': { 'slidesPerView': 4 },
                            '1200': { 'slidesPerView': 4 }
                          }
                        }">
                                <div class="swiper-wrapper row cols-lg-5 cols-md-4 cols-sm-3 cols-2"
                                    id="new-arrivals-container">
                                    <!-- Products will be loaded here dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Best Seller Tab -->
                        <div class="tab-pane" id="tab1-4">
                            <div class="swiper-container swiper-theme latest-product-wrapper shadow-swiper appear-animate mb-0"
                                data-swiper-options="{
                          'spaceBetween': 10,
                          'slidesPerView': 1.1,
                          'breakpoints': {
                            '576': { 'slidesPerView': 2 },
                            '768': { 'slidesPerView': 3 },
                            '992': { 'slidesPerView': 4 },
                            '1200': { 'slidesPerView': 4 }
                          }
                        }">
                                <div class="swiper-wrapper row cols-lg-5 cols-md-4 cols-sm-3 cols-2"
                                    id="best-seller-container">
                                    <!-- Products will be loaded here dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Top Rated Tab -->
                        <div class="tab-pane" id="tab1-5">
                            <div class="swiper-container swiper-theme latest-product-wrapper shadow-swiper appear-animate mb-0"
                                data-swiper-options="{
                          'spaceBetween': 10,
                          'slidesPerView': 1.1,
                          'breakpoints': {
                            '576': { 'slidesPerView': 2 },
                            '768': { 'slidesPerView': 3 },
                            '992': { 'slidesPerView': 4 },
                            '1200': { 'slidesPerView': 4 }
                          }
                        }">
                                <div class="swiper-wrapper row cols-lg-5 cols-md-4 cols-sm-3 cols-2"
                                    id="top-rated-container">
                                    <!-- Products will be loaded here dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End of Tab Content -->

                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            // Load products for each tab
                            loadProducts('all', 'all-products-container');
                            loadProducts('best-deals', 'best-deals-container');
                            loadProducts('new-arrivals', 'new-arrivals-container');
                            loadProducts('best-seller', 'best-seller-container');
                            loadProducts('top-rated', 'top-rated-container');

                            // Tab click handlers
                            document.querySelectorAll('.nav-tabs a').forEach(tab => {
                                tab.addEventListener('click', function (e) {
                                    e.preventDefault();
                                    // Activate tab
                                    document.querySelectorAll('.nav-tabs a').forEach(t => t.classList.remove('active'));
                                    this.classList.add('active');
                                    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                                    const tabId = this.getAttribute('href');
                                    const tabPane = document.querySelector(tabId);
                                    if (tabPane) tabPane.classList.add('active');

                                    const containerId = this.getAttribute('data-container');
                                    const type = this.getAttribute('data-type');
                                    const container = document.getElementById(containerId);

                                    if (container && container.children.length === 0) {
                                        loadProducts(type, containerId);
                                    }
                                });
                            });
                        });

                        function loadProducts(type, containerId) {
                            const container = document.getElementById(containerId);
                            if (!container) {
                                console.error('Container not found:', containerId);
                                return;
                            }
                            fetch(`/product-type/${type}?limit=10`)
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success && data.products.length > 0) {
                                        container.innerHTML = '';

                                        data.products.forEach(product => {
                                            const productElement = createProductElement(product);
                                            container.appendChild(productElement);
                                        });

                                        // Find the swiper-container parent
                                        let swiperContainer = container;
                                        while (swiperContainer && !swiperContainer.classList.contains('swiper-container')) {
                                            swiperContainer = swiperContainer.parentElement;
                                        }
                                        if (swiperContainer) {
                                            new Swiper(swiperContainer, {
                                                spaceBetween: 10,
                                                slidesPerView: 1.1,
                                                breakpoints: {
                                                    576: { slidesPerView: 2 },
                                                    768: { slidesPerView: 3 },
                                                    992: { slidesPerView: 4 },
                                                    1200: { slidesPerView: 4 }
                                                }
                                            });
                                        }
                                    }
                                })
                                .catch(error => console.error('Error loading products:', error));
                        }

                        // Cart and Wishlist functionality
                        document.addEventListener('DOMContentLoaded', function () {
                            const selectedVariants = {};

                            function updateSelectedVariantInfo(productId) {
                                const productEl = document.querySelector(`.swiper-slide[data-product-id="${productId}"]`);
                                if (!productEl) return;
                                const infoDiv = productEl.querySelector('.selected-variant-info');
                                if (!infoDiv) return;
                                const variant = selectedVariants[productId] || {};
                                let info = '';

                                // Highlight selected size
                                if (productEl.getAttribute('data-has-size') === 'true') {
                                    const selectedSize = variant.selectedSize;
                                    productEl.querySelectorAll('.size-option').forEach(el => {
                                        if (el.getAttribute('data-size') === selectedSize) {
                                            el.classList.add('active', 'selected');
                                        } else {
                                            el.classList.remove('active', 'selected');
                                        }
                                    });
                                    info += selectedSize
                                        ? `<span class="mr-2"><strong>Size:</strong> <span class="badge badge-success">${selectedSize}</span></span>`
                                        : `<span class="mr-2 text-danger">Select Size</span>`;
                                }

                                // Highlight selected color
                                if (productEl.getAttribute('data-has-color') === 'true') {
                                    const selectedColor = variant.selectedColor;
                                    productEl.querySelectorAll('.color-option').forEach(el => {
                                        if (el.getAttribute('data-color') === selectedColor) {
                                            el.classList.add('active', 'selected');
                                        } else {
                                            el.classList.remove('active', 'selected');
                                        }
                                    });
                                    info += selectedColor
                                        ? `<span class="mr-2"><strong>Color:</strong> <span class="badge badge-success" style="background:${selectedColor};color:#fff;border:1px solid #ccc;">${selectedColor}</span></span>`
                                        : `<span class="mr-2 text-danger">Select Color</span>`;
                                }

                                infoDiv.innerHTML = info;
                            }

                            // Size selection
                            document.addEventListener('click', function (e) {
                                if (e.target.classList.contains('size-option')) {
                                    const el = e.target;
                                    const productEl = el.closest('.swiper-slide');
                                    const productId = productEl.getAttribute('data-product-id');
                                    // Remove active from siblings
                                    productEl.querySelectorAll('.size-option').forEach(sib => {
                                        sib.classList.remove('active', 'selected');
                                    });
                                    el.classList.add('active', 'selected');
                                    selectedVariants[productId] = selectedVariants[productId] || {};
                                    selectedVariants[productId].selectedSize = el.getAttribute('data-size');
                                    updateSelectedVariantInfo(productId);
                                }
                            });

                            // Color selection
                            document.addEventListener('click', function (e) {
                                if (e.target.classList.contains('color-option')) {
                                    const el = e.target;
                                    const productEl = el.closest('.swiper-slide');
                                    const productId = productEl.getAttribute('data-product-id');
                                    // Remove active from siblings
                                    productEl.querySelectorAll('.color-option').forEach(sib => {
                                        sib.classList.remove('active', 'selected');
                                    });
                                    el.classList.add('active', 'selected');
                                    selectedVariants[productId] = selectedVariants[productId] || {};
                                    selectedVariants[productId].selectedColor = el.getAttribute('data-color');
                                    updateSelectedVariantInfo(productId);
                                }
                            });

                            // Wishlist functionality
                            document.addEventListener('click', function (e) {
                                if (e.target.classList.contains('btn-wishlist')) {
                                    e.preventDefault();
                                    const productEl = e.target.closest('.swiper-slide');
                                    const productId = productEl.getAttribute('data-product-id');
                                    addToWishlist(productId, e.target);
                                }
                            });

                            // Add to Cart button
                            document.addEventListener('click', async function (e) {
                                if (e.target.classList.contains('add-to-cart-btn')) {
                                    e.preventDefault();
                                    const btn = e.target;
                                    const productId = btn.getAttribute('data-product-id');
                                    const hasColor = btn.getAttribute('data-has-color') === 'true';
                                    const hasSize = btn.getAttribute('data-has-size') === 'true';
                                    const productName = btn.getAttribute('data-product-name');
                                    const productImage = btn.getAttribute('data-product-image');
                                    const productPrice = btn.getAttribute('data-product-price') ?
                                        parseFloat(btn.getAttribute('data-product-price')) : null;

                                    let selectedColor = null;
                                    let selectedSize = null;

                                    if (hasColor) {
                                        selectedColor = (selectedVariants[productId] && selectedVariants[productId].selectedColor) || null;
                                        if (!selectedColor) {
                                            showToast('Please select a color.', "error");
                                            updateSelectedVariantInfo(productId);
                                            return;
                                        }
                                    }

                                    if (hasSize) {
                                        selectedSize = (selectedVariants[productId] && selectedVariants[productId].selectedSize) || null;
                                        if (!selectedSize) {
                                            showToast('Please select a size.', "error");
                                            updateSelectedVariantInfo(productId);
                                            return;
                                        }
                                    }

                                    await addToCart(productId, 1, selectedColor, selectedSize, productName, productImage, productPrice);
                                }
                            });

                            // Initialize variant info on new products
                            const observer = new MutationObserver(function (mutations) {
                                mutations.forEach(function (mutation) {
                                    mutation.addedNodes.forEach(function (node) {
                                        if (node.nodeType === 1 && node.classList && node.classList.contains('swiper-slide')) {
                                            const productId = node.getAttribute('data-product-id');
                                            updateSelectedVariantInfo(productId);
                                        }
                                    });
                                });
                            });

                            // Observe all product containers
                            document.querySelectorAll('[id$="-container"]').forEach(container => {
                                observer.observe(container, { childList: true, subtree: true });
                            });
                        });

                        function addToWishlist(productId, el) {
                            const productCard = el.closest('.product');
                            const hasColor = productCard.dataset.hasColor === 'true';
                            const hasSize = productCard.dataset.hasSize === 'true';

                            const selectedColor = productCard.querySelector('.color-option.selected')?.dataset.color || null;
                            const selectedSize = productCard.querySelector('.size-option.selected')?.dataset.size || null;

                            const body = {
                                productId,
                                ...(hasColor ? { selectedColor } : {}),
                                ...(hasSize ? { selectedSize } : {})
                            };

                            fetch('/create-wishlist', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(body)
                            })
                                .then(res => res.json())
                                .then(data => {
                                    if (data && data.success) {
                                        showToast("Added to wishlist!", "success");
                                        if (el) el.classList.add('active');
                                    } else {
                                        showToast(data.error || "Could not add to wishlist.", "error");
                                    }
                                })
                                .catch(() => {
                                    showToast("Error adding to wishlist.", "error");
                                });
                        }

                        function showToast(message, type = "success") {
                            Toastify({
                                text: message,
                                duration: 2500,
                                close: true,
                                gravity: "top",
                                position: "right",
                                backgroundColor: type === "success"
                                    ? "linear-gradient(90deg, #00b09b, #96c93d)"
                                    : "linear-gradient(90deg, #e74c3c, #c0392b)",
                                stopOnFocus: true
                            }).showToast();
                        }

                        async function addToCart(productId, quantity = 1, selectedColor = null, selectedSize = null, productName = null, productImage = null, productPrice = null) {
                            const isLoggedIn = window.isLoggedIn === true || window.isLoggedIn === 'true';

                            const item = {
                                productId,
                                quantity,
                                selectedColor,
                                selectedSize,
                                productName,
                                productImage,
                                price: productPrice
                            };

                            if (isLoggedIn) {
                                try {
                                    const res = await fetch('/add-cart', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        credentials: 'include',
                                        body: JSON.stringify(item)
                                    });

                                    const data = await res.json();
                                    if (data.error) {
                                        showToast(data.error, "error");
                                        return;
                                    }

                                    showToast("Product added to your cart!", "success");
                                } catch (err) {
                                    console.error("Error adding to cart:", err);
                                    showToast("Error adding to cart.", "error");
                                }
                            } else {
                                let guestCart = JSON.parse(localStorage.getItem('guestCart')) || [];

                                const exists = guestCart.find(p =>
                                    p.productId === item.productId &&
                                    p.selectedColor === item.selectedColor &&
                                    p.selectedSize === item.selectedSize
                                );

                                if (exists) {
                                    exists.quantity += item.quantity;
                                } else {
                                    guestCart.push(item);
                                }

                                localStorage.setItem('guestCart', JSON.stringify(guestCart));
                                showToast("Product added to guest cart!", "success");
                            }
                        }

                        function createProductElement(product) {
                            // Determine price display
                            const priceHtml = product.salePrice > 0
                                ? `<ins class="new-price">₹${product.salePrice.toFixed(2)}</ins><del class="old-price">₹${product.basePrice.toFixed(2)}</del>`
                                : `<ins class="new-price">₹${product.basePrice.toFixed(2)}</ins>`;

                            // Create size options if available
                            let sizeOptions = '';
                            if (product.hasSizeVariants && product.sizeVariants) {
                                sizeOptions = product.sizeVariants.map(size =>
                                    `<span class="size-option badge badge-light border px-2 py-1 mr-1"
                                      data-size="${size.size}"
                                      data-stock="${size.stock}"
                                      style="cursor:pointer;">
                                   ${size.size}
                                 </span>`
                                ).join('');
                            }

                            // Create color options if available
                            let colorOptions = '';
                            if (product.hasColorVariants && product.colorVariants) {
                                colorOptions = product.colorVariants.map(color =>
                                    `<span class="color-option border rounded-circle d-inline-block mr-1 mb-1"
                                      data-color="${color.color}"
                                      data-stock="${color.stock}"
                                      title="${color.color}"
                                      style="width:22px;height:22px;cursor:pointer;background:${color.color};border:2px solid #eee;">
                                 </span>`
                                ).join('');
                            }

                            // Main product HTML
                            return document.createRange().createContextualFragment(`
                                <div class="swiper-slide product product-image-gap product-simple"
                                    data-product-id="${product._id}"
                                    data-has-color="${product.hasColorVariants}"
                                    data-has-size="${product.hasSizeVariants}"
                                    data-product-name="${product.name.replace(/"/g, '&quot;')}"
                                    data-product-image="${product.images && product.images[0] ? product.images[0] : ''}"
                                    data-product-price="${product.salePrice || product.basePrice}">
                        
                                    <figure class="product-media">
                                        <a href="/product/${product._id}">
                                            ${product.images && product.images[0] ?
                                    `<img src="${product.images[0]}" alt="${product.name}" width="295" height="335" />` :
                                    '<img src="/images/placeholder-product.jpg" alt="Product" width="295" height="335" />'}
                                            ${product.images && product.images[1] ?
                                    `<img src="${product.images[1]}" alt="${product.name}" width="295" height="335" />` : ''}
                                        </a>
                                    </figure>
                        
                                    <div class="product-details">
                                        <div class='wish-btn'>
                                        <a href="#" class="btn-wishlist w-icon-heart" title="Add to wishlist"></a>
                                        <h4 class="product-name">
                                            <a href="/product/${product._id}">${product.name}</a>
                                        </h4>
                                        </div>
                        
                                        <div class="product-variations flex flex-wrap mb-2">
                                            ${product.hasSizeVariants ? `
                                                <div class="product-size d-flex align-items-center">
                                                    <span class="font-weight-bold mr-1">Size:</span>
                                                    <div>${sizeOptions}</div>
                                                </div>` : ''}
                        
                                            ${product.hasColorVariants ? `
                                                <div class="product-color">
                                                    <span class="font-weight-bold ">Color:</span>
                                                    ${colorOptions}
                                                </div>` : ''}
                                        </div>        
                        
                                        <div class="product-pa-wrapper">
                                            <div class="product-price">${priceHtml}</div>
                                            <div class="product-action">
                                                <button class="btn-cart btn-product btn btn-link btn-underline add-to-cart-btn"
                                                    data-product-id="${product._id}"
                                                    data-has-color="${product.hasColorVariants}"
                                                    data-has-size="${product.hasSizeVariants}"
                                                    data-product-name="${product.name.replace(/"/g, '&quot;')}"
                                                    data-product-image="${product.images && product.images[0] ? product.images[0] : ''}"
                                                    data-product-price="${product.salePrice || product.basePrice}">
                                                    Add To Cart
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="selected-variant-info mt-2"></div>
                                    </div>
                                </div>
                            `);
                        }
                    </script>

                    <div class="title-link-wrapper title-post after-none mb-4 appear-animate">
                        <h2 class="title font-secondary ls-normal mb-0">From Our Blog</h2>
                        <a href="/blogs" class="font-weight-bold font-size-normal mb-0">
                            View All Articles
                            <i class="w-icon-long-arrow-right"></i>
                        </a>
                    </div>
                    <div class="swiper-container swiper-theme post-wrapper pb-2 pb-lg-0 mb-5 appear-animate"
                        data-swiper-options="{
                            'slidesPerView': 1,
                            'spaceBetween': 20,
                            'breakpoints': {
                                '576': { 'slidesPerView': 2 },
                                '768': { 'slidesPerView': 3 },
                                '992': { 'slidesPerView': 4, 'dots': false }
                            }
                        }">
                        <div class="swiper-wrapper row cols-lg-4 cols-md-3 cols-sm-2 cols-1">
                            <% if (blogs && blogs.length) { %>
                                <% blogs.forEach(function(blog) { %>
                                    <div class="swiper-slide post text-center overlay-zoom">
                                        <figure class="post-media br-sm">
                                            <a href="/blogs/<%= blog._id %>">
                                                <img src="<%= blog.imageUrl %>" alt="<%= blog.title %>" width="325"
                                                    height="214"
                                                    style="background-color: #f5f5f5; object-fit:cover; height: 300px;" />
                                            </a>
                                        </figure>
                                        <div class="post-details">
                                            <div class="post-meta">
                                                by <a href="#" class="post-author">
                                                    <%= blog.author %>
                                                </a>
                                                - <a href="#" class="post-date mr-0">
                                                    <%= blog.createdAt ? new
                                                        Date(blog.createdAt).toLocaleDateString('en-IN', {
                                                        year: 'numeric' , month: 'short' , day: 'numeric' }) : '' %>
                                                </a>
                                            </div>
                                            <h4 class="post-title">
                                                <a href="/blogs/<%= blog._id %>">
                                                    <%= blog.title %>
                                                </a>
                                            </h4>
                                            <a href="/blogs/<%= blog._id %>"
                                                class="btn btn-link btn-dark btn-underline">
                                                Read More
                                                <i class="w-icon-long-arrow-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <% }) %>
                                        <% } else { %>
                                            <div class="col-12 text-center py-5">
                                                <p class="text-muted mb-0">No blog articles found.</p>
                                            </div>
                                            <% } %>
                        </div>
                        <div class="swiper-pagination mt-2"></div>
                    </div>
                </div>
                <!-- End of Container -->

        </main>
        <!-- End of Main -->

        <!-- Start of Footer -->
        <footer class="footer appear-animate" data-animation-options="{
            'name': 'fadeIn'
        }">
            <div class="footer-newsletter bg-primary">
                <div class="container">
                    <div class="row justify-content-center align-items-center">
                        <div class="col-xl-5 col-lg-6">
                            <div class="icon-box icon-box-side text-white">
                                <div class="icon-box-icon d-inline-flex">
                                    <i class="w-icon-envelop3"></i>
                                </div>
                                <div class="icon-box-content">
                                    <h4 class="icon-box-title text-white text-uppercase font-weight-bold">Subscribe To
                                        Our Newsletter</h4>
                                    <p class="text-white">Get all the latest information on Events, Sales and Offers.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-7 col-lg-6 col-md-9 mt-4 mt-lg-0 ">
                            <form action="#" method="get"
                                class="input-wrapper input-wrapper-inline input-wrapper-rounded">
                                <input type="email" class="form-control mr-2 bg-white" name="email" id="email"
                                    placeholder="Your E-mail Address" />
                                <button class="btn btn-dark btn-rounded" type="submit">Subscribe<i
                                        class="w-icon-long-arrow-right"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="footer-top">
                    <div class="row">
                        <div class="col-lg-4 col-sm-6">
                            <div class="widget widget-about mt-0 mb-4">
                                <a href="/" class="logo-footer">
                                    <img src="/images/logo.png" alt="logo-footer" width="200" height="45" />
                                </a>
                                <div class="widget-body">
                                    <p class="widget-about-title">Got Question? Call us 24/7</p>
                                    <a href="tel:+919400947122" class="widget-about-call">+91 9400947122</a>
                                    <p>Follow Us In :</p>
                                    <div class="social-icons social-icons-colored">
                                        <a    target="_blank"  href="https://www.facebook.com/profile.php?id=61577041363849#"
                                            class="social-icon social-facebook w-icon-facebook"></a>
                                        <a    target="_blank"  href="https://www.instagram.com/hofmaan.official/?fbclid=IwY2xjawLJwfRleHRuA2FlbQIxMQBicmlkETFtbmQ0UnlRc3gyNDAwaU44AR5ZqTiWzEixcnjCAnjWdJJKxyOo1SDmgvhwN8_53T5gbWCz_nWAy3l3UTZALw_aem_icwl_UgQrgnfthtQ81Mmyw"
                                            class="social-icon social-instagram w-icon-instagram"></a>
                                        <a    target="_blank"  href="https://www.youtube.com/@hofmaanofficial"
                                            class="social-icon social-youtube w-icon-youtube"></a>
                                                <a    target="_blank"  href="https://in.pinterest.com/hofmaan_official/"
                                            class="social-icon social-pinterest w-icon-pinterest"></a>
                            <a href="https://www.linkedin.com/company/107658144/admin/page-posts/published/" 
   class="social-icon" 
   target="_blank" 
   rel="noopener noreferrer">
   <i style="color: blue;" class="fab fa-linkedin-in"></i> 
</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="widget">
                                <h3 class="widget-title">Company</h3>
                                <ul class="widget-body">
                                    <li><a href="/">Home</a></li>
                                    <li><a href="/store">Store</a></li>
                                    <li><a href="/about">About Us</a></li>
                                    <li><a href="/blogs">Blogs</a></li>
                                    <li><a href="/contact">Contact Us</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="widget">
                                <h4 class="widget-title">My Account</h4>
                                <ul class="widget-body">
                                    <li><a href="/orders">Track My Order</a></li>
                                    <li><a href="/cart">View Cart</a></li>
                                    <% if (user) { %>
                                        <li><a href="/account">Account</a></li>
                                        <% } else { %>
                                            <li><a href="/auth/login">Sign In</a></li>
                                            <% } %>
                                                <li><a href="/wishlist">My Wishlist</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="widget">
                                <h4 class="widget-title">Customer Service</h4>
                                <ul class="widget-body">
                                    <li><a href="/terms_and_conditions">Terms and Conditions</a></li>
                                    <li><a href="/Cancellation_Refund">Cancellation Refund</a></li>
                                    <li><a href="/shipping_policy">Shipping Policy</a></li>
                                    <li><a href="/privacy_policy">Privacy Policy</a></li>

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="footer-bottom">
                    <div class="footer-left">
                        <p class="copyright">
                            Copyright © 2025 Hofmaan. All Rights Reserved. &nbsp;|&nbsp;
                            developed by <a href="https://trivlogic.com/" target="_blank" rel="noopener" style="color:#888;text-decoration:none;">Trivlogic Pvt Ltd</a>
                        </p>
                    </div>
                    <div class="footer-right">
                        <span class="payment-label mr-lg-8">We're using safe payment for</span>
                        <figure class="payment">
                            <img src="/images/payment.png" alt="payment" width="159" height="35" />
                        </figure>
                    </div>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->
    </div>
    <!-- End of Page-wrapper -->

    <div class="btm-main">
        <a href="#" id="mobileSearchRedirect" class="search-bar-link">
            <div class="search-bar" id="searchBar">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-input-icon"></i>
                        <input type="text" class="search-input" placeholder="Search products..." id="mobileSearchInput">
                    </div>
                    <button class="search-btn" id="mobileSearchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </a>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const input = document.getElementById('mobileSearchInput');
                const btn = document.getElementById('mobileSearchButton');
                const link = document.getElementById('mobileSearchRedirect');
                function doSearch(e) {
                    e.preventDefault();
                    const q = input.value.trim();
                    if (q.length > 0) {
                        window.location.href = '/store?q=' + encodeURIComponent(q);
                    }
                }
                btn.addEventListener('click', doSearch);
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        doSearch(e);
                    }
                });
                link.addEventListener('click', function(e) {
                    // Prevent default link if not searching
                    if (input.value.trim().length === 0) e.preventDefault();
                });
            });
        </script>

        <nav class="mobile-bottom-nav">

            <div class="mob-btm-nav">
                <a href="/cart" class="sticky-link1">
                    <i class="fas fa-shopping-cart"></i>
                    <p>Cart</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="/orders" class="sticky-link1">
                    <i class="fas fa-clipboard-list"></i>
                    <p>Orders</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="#0" id="searchBtn" class="sticky-link1">
                    <i class="fas fa-search"></i>
                    <p>Search</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="/wishlist" class="sticky-link1">
                    <i class="fas fa-heart"></i>
                    <p>Wishlist</p>
                </a>
            </div>
        </nav>
    </div>

    <div class="sticky-footer sticky-content fix-bottom">

        <a href="/" class="sticky-link  active-mob">
            <i class="w-icon-home"></i>
            <p>Home</p>
        </a>
        <a href="/store" class="sticky-link">
            <i class="w-icon-products"></i>
            <p>Store</p>
        </a>
        <a class="btm-img" href="/"> <img src="/images/logo-2.png" alt=""></a>
        <% if (user) { %>
            <a href="/account" class="sticky-link">
                <i class="w-icon-account"></i>
                <p>Account</p>
            </a>
            <% } else { %>
                <a href="/auth/login" class="sticky-link">
                    <i class="w-icon-account"></i>
                    <p>Login</p>
                </a>
                <% } %>


                    <a href="/contact" class="sticky-link">
                        <i class="w-icon-call2"></i>
                        <p>Contact </p>
                    </a>
    </div>

    <!-- Start of Scroll Top -->
    <a id="scroll-top" class="scroll-top" href="#top" title="Top" role="button"> <i class="w-icon-angle-up"></i> <svg
            version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 70">
            <circle id="progress-indicator" fill="transparent" stroke="#000000" stroke-miterlimit="10" cx="35" cy="35"
                r="34" style="stroke-dasharray: 16.4198, 400;"></circle>
        </svg> </a>
    <!-- End of Scroll Top -->

    <!-- Start of Mobile Menu -->
    <div class="mobile-menu-wrapper">
        <div class="mobile-menu-overlay"></div>
        <!-- End of .mobile-menu-overlay -->

        <a href="#" class="mobile-menu-close"><i class="close-icon"></i></a>
        <!-- End of .mobile-menu-close -->

        <div class="mobile-menu-container scrollable">
            <img class="side-logo" src="/images/logo.png" alt="logo">
            <!-- End of Search Form -->
            <div class="tab">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a href="#main-menu" class="nav-link active">Main Menu</a>
                    </li>
                    <li class="nav-item">
                        <a href="#categories" class="nav-link">Categories</a>
                    </li>
                </ul>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="main-menu">
                    <ul class="mobile-menu">
                        <li><a href="/">Home</a></li>
                        <li><a href="/store">Store</a></li>
                        <li><a href="/login">Profile</a></li>
                        <li><a href="/wishlist">Wishlist</a></li>
                        <li><a href="/cart">Cart</a></li>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/about">Blogs</a></li>
                        <li><a href="/contact">Contact Us</a></li>

                    </ul>
                </div>
                <div class="tab-pane" id="categories">
                    <ul class="mobile-menu">
                        <% categories.forEach(category=> { %>
                            <li>
                                <a style="gap: 10px!important; display: flex;" href="/category/<%= category._id %>">
                                    <img style="height: 30px; width: 30px; border-radius: 50px;"
                                        src="<%= category.imageUrl || '/images/hofmaan/sample3.jpg' %>" alt="">
                                    <%= category.name %>
                                </a>
                                <% if (category.subCategories && category.subCategories.length> 0) { %>
                                    <ul>
                                        <% category.subCategories.forEach(sub=> { %>
                                            <% if (sub.isActive) { %>
                                                <li>
                                                    <a href="/subcategory/<%= sub._id %>">
                                                        <%= sub.name %>
                                                    </a>
                                                </li>
                                                <% } %>
                                                    <% }); %>
                                    </ul>
                                    <% } %>
                            </li>
                            <% }); %>
                    </ul>

                </div>
            </div>
        </div>
    </div>
    <!-- End of Mobile Menu -->

  <!--whats app icon -->
<div class="whatsapp-float">
  <a href="https://wa.me/+919400947122" target="_blank" rel="noopener noreferrer">
    <i class="fab fa-whatsapp whatsapp-icon"></i>
  </a>
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const searchForm = document.getElementById('searchForm');
            const suggestionsContainer = document.getElementById('searchSuggestions');
            const resultsContainer = document.getElementById('searchResults');
            let searchTimeout;

            // Helper to safely format price
            function formatPrice(price) {
                if (typeof price === 'number' && !isNaN(price)) {
                    return price.toLocaleString('en-IN');
                }
                if (typeof price === 'string' && price.trim() !== '' && !isNaN(Number(price))) {
                    return Number(price).toLocaleString('en-IN');
                }
                return '';
            }

            // Search input handler
            searchInput.addEventListener('input', function (e) {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();

                if (query.length < 2) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                searchTimeout = setTimeout(() => {
                    fetchSuggestions(query);
                }, 300);
            });

            // Form submission handler
            searchForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                }
            });

            // Close results when clicking outside
            document.addEventListener('click', function (e) {
                if (!searchForm.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                    resultsContainer.style.display = 'none';
                }
            });

            // Fetch search suggestions
            async function fetchSuggestions(query) {
                try {
                    const response = await fetch(`/search/suggestions?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const suggestions = await response.json();

                    if (!Array.isArray(suggestions)) {
                        throw new Error('Invalid suggestions format');
                    }

                    displaySuggestions(suggestions);
                } catch (error) {
                    console.error('Error fetching suggestions:', error);
                    suggestionsContainer.style.display = 'none';
                    suggestionsContainer.innerHTML = '<div class="error-message">Failed to load suggestions</div>';
                }
            }

            // Display suggestions
            function displaySuggestions(suggestions) {
                if (!suggestions || suggestions.length === 0) {
                    suggestionsContainer.innerHTML = '<div class="no-suggestions">No suggestions found</div>';
                    suggestionsContainer.style.display = 'block';
                    return;
                }

                suggestionsContainer.innerHTML = '';
                suggestions.forEach(item => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    suggestionItem.innerHTML = `
            ${item.images?.length ? `<img src="${item.images[0]}" alt="${item.name}" />` : ''}
            <div class="suggestion-text">
                <div class="suggestion-name">${item.name}</div>
                <div class="suggestion-price">₹${formatPrice(item.basePrice)}</div>
            </div>
        `;
                    // ✅ Navigate to product page directly
                    suggestionItem.addEventListener('click', () => {
                        window.location.href = `/product/${item._id}`;
                    });
                    suggestionsContainer.appendChild(suggestionItem);
                });
                suggestionsContainer.style.display = 'block';
            }

            // Perform full search
            async function performSearch(query) {
                try {
                    const response = await fetch(`/search?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const results = await response.json();

                    if (!Array.isArray(results)) {
                        throw new Error('Invalid results format');
                    }

                    displaySearchResults(query, results);
                } catch (error) {
                    console.error('Error performing search:', error);
                    displaySearchResults(query, []);
                }
            }

            // Display search results
            function displaySearchResults(query, products) {
                suggestionsContainer.style.display = 'none';

                if (!products || products.length === 0) {
                    resultsContainer.innerHTML = `
                <div class="no-results">
                    <h3>No results found for "${query}"</h3>
                    <p>Try different keywords or browse our categories</p>
                </div>
            `;
                } else {
                    resultsContainer.innerHTML = `
                <div class="search-results-header">
                    <h3>Results for "${query}" (${products.length})</h3>
                    <span class="close-results">&times;</span>
                </div>
                <div class="search-results-grid">
                    ${products.map(product => {
                        const priceStr = formatPrice(product.basePrice);
                        return `
                        <div class="search-result-item">
                            <a href="/product/${product._id}">
                                <img src="${product.images?.[0] || '/images/placeholder.jpg'}" alt="${product.name}" />
                                <div class="item-details">
                                    <h4>${product.name}</h4>
                                <div class="item-price">₹${formatPrice(product.salePrice || product.basePrice)}</div>
                                    ${product.description ? `<p class="item-desc">${product.description.substring(0, 60)}...</p>` : ''}
                                </div>
                            </a>
                        </div>
                        `;
                    }).join('')}
                </div>
            `;
                }

                // Show results container
                resultsContainer.style.display = 'block';

                // Close button handler
                const closeBtn = resultsContainer.querySelector('.close-results');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        resultsContainer.style.display = 'none';
                    });
                }
            }
        });
    </script>

    <script>
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const googleLogin = urlParams.get('googleLogin');

            if (googleLogin === 'true') {
                localStorage.removeItem('guestCart');
                const cleanUrl = window.location.origin + window.location.pathname;
                window.history.replaceState({}, document.title, cleanUrl);
            }
        });
    </script>

    <script>

        (function () {
            const selectedVariants = {};

            function updateSelectedVariantInfo(productId) {
                const productEl = document.querySelector('.swiper-slide[data-product-id="' + productId + '"]');
                if (!productEl) return;
                const infoDiv = productEl.querySelector('.selected-variant-info');
                if (!infoDiv) return;
                const variant = selectedVariants[productId] || {};
                let info = '';
                if (productEl.getAttribute('data-has-size') === 'true') {
                    info += variant.selectedSize
                        ? `<span class="mr-2"><strong>Size:</strong> <span class="badge badge-success">${variant.selectedSize}</span></span>`
                        : `<span class="mr-2 text-danger">Select Size</span>`;
                }
                if (productEl.getAttribute('data-has-color') === 'true') {
                    info += variant.selectedColor
                        ? `<span class="mr-2"><strong>Color:</strong> <span class="badge badge-success" style="background:${variant.selectedColor};color:#fff;border:1px solid #ccc;">${variant.selectedColor}</span></span>`
                        : `<span class="mr-2 text-danger">Select Color</span>`;
                }
                infoDiv.innerHTML = info;
            }

            // Helper to remove all previous event listeners for add-to-cart-btn
            function removeAllAddToCartListeners() {
                const btns = document.querySelectorAll('.add-to-cart-btn');
                btns.forEach(btn => {
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                });
            }

            document.addEventListener('DOMContentLoaded', function () {
                // Remove any previously attached event listeners to prevent double firing
                removeAllAddToCartListeners();

                // Size selection
                document.querySelectorAll('.product-size .size-option').forEach(function (el) {
                    el.addEventListener('click', function () {
                        const productEl = el.closest('.swiper-slide');
                        const productId = productEl.getAttribute('data-product-id');
                        // Remove active from siblings
                        productEl.querySelectorAll('.product-size .size-option').forEach(sib => sib.classList.remove('active'));
                        el.classList.add('active');
                        selectedVariants[productId] = selectedVariants[productId] || {};
                        selectedVariants[productId].selectedSize = el.getAttribute('data-size');
                        updateSelectedVariantInfo(productId);
                    });
                });

                // Color selection
                document.querySelectorAll('.product-color .color-option').forEach(function (el) {
                    el.addEventListener('click', function () {
                        const productEl = el.closest('.swiper-slide');
                        const productId = productEl.getAttribute('data-product-id');
                        // Remove active from siblings
                        productEl.querySelectorAll('.product-color .color-option').forEach(sib => sib.classList.remove('active'));
                        el.classList.add('active');
                        selectedVariants[productId] = selectedVariants[productId] || {};
                        selectedVariants[productId].selectedColor = el.getAttribute('data-color');
                        updateSelectedVariantInfo(productId);
                    });
                });

                // Add to Cart button
                document.querySelectorAll('.add-to-cart-btn1').forEach(function (btn) {
                    btn.addEventListener('click', async function (e) {
                        e.preventDefault();
                        const productId = btn.getAttribute('data-product-id');
                        const hasColor = btn.getAttribute('data-has-color') === 'true';
                        const hasSize = btn.getAttribute('data-has-size') === 'true';
                        const productName = btn.getAttribute('data-product-name');
                        const productImage = btn.getAttribute('data-product-image');
                        const productPrice = btn.getAttribute('data-product-price') ? parseFloat(btn.getAttribute('data-product-price')) : null;

                        let selectedColor = null;
                        let selectedSize = null;

                        if (hasColor) {
                            selectedColor = (selectedVariants[productId] && selectedVariants[productId].selectedColor) || null;
                            if (!selectedColor) {
                                showToast('Please select a color.', "error");
                                updateSelectedVariantInfo(productId);
                                return;
                            }
                        }
                        if (hasSize) {
                            selectedSize = (selectedVariants[productId] && selectedVariants[productId].selectedSize) || null;
                            if (!selectedSize) {
                                showToast('Please select a size.', "error");
                                updateSelectedVariantInfo(productId);
                                return;
                            }
                        }

                        await addToCart(productId, 1, selectedColor, selectedSize, productName, productImage, productPrice);
                    });
                });

                // On page load, show default variant info
                document.querySelectorAll('.swiper-slide.product').forEach(function (el) {
                    const productId = el.getAttribute('data-product-id');
                    updateSelectedVariantInfo(productId);
                });
            });

            window.showToast = function (message, type = "success") {
                // Prevent duplicate Toastify notifications by using a flag
                if (window._toastifyActive) return;
                window._toastifyActive = true;
                Toastify({
                    text: message,
                    duration: 2500,
                    close: true,
                    gravity: "top",
                    position: "right",
                    backgroundColor: type === "success"
                        ? "linear-gradient(90deg, #00b09b, #96c93d)"
                        : "linear-gradient(90deg, #e74c3c, #c0392b)",
                    stopOnFocus: true,
                    callback: function () {
                        window._toastifyActive = false;
                    }
                }).showToast();
                setTimeout(function () {
                    window._toastifyActive = false;
                }, 2600);
            };

            // Add price to guestCart
            window.addToCart = async function (productId, quantity = 1, selectedColor = null, selectedSize = null, productName = null, productImage = null, productPrice = null) {
                var isLoggedIn = <%= user ? 'true' : 'false' %>;
                isLoggedIn = (isLoggedIn === true || isLoggedIn === 'true');

                const item = { productId, quantity, selectedColor, selectedSize };

                if (productName) item.productName = productName;
                if (productImage) item.productImage = productImage;
                if (typeof productPrice === "number" && !isNaN(productPrice)) item.price = productPrice;

                if (isLoggedIn) {
                    localStorage.removeItem('guestCart');
                    try {
                        const res = await fetch('/add-cart', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify(item)
                        });

                        const data = await res.json();
                        if (data.error) {
                            showToast(data.error, "error");
                            return;
                        }

                        showToast("Product added to your cart!", "success");
                    } catch (err) {
                        console.error("Error adding to cart:", err);
                        showToast("Error adding to cart.", "error");
                    }
                } else {
                    let guestCart = JSON.parse(localStorage.getItem('guestCart')) || [];

                    const exists = guestCart.find(p =>
                        p.productId === item.productId &&
                        p.selectedColor === item.selectedColor &&
                        p.selectedSize === item.selectedSize
                    );

                    if (exists) {
                        exists.quantity += item.quantity;
                    } else {
                        guestCart.push(item);
                    }

                    localStorage.setItem('guestCart', JSON.stringify(guestCart));
                    showToast("Product added to guest cart!", "success");
                }
            };
        })();
    </script>

    <script>
        window.isLoggedIn = <%= user ? 'true' : 'false' %>;
    </script>

    <!-- Plugin JS File -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/parallax/parallax.min.js"></script>
    <script src="/vendor/jquery.plugin/jquery.plugin.min.js"></script>
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/vendor/skrollr/skrollr.min.js"></script>
    <script src="/vendor/zoom/jquery.zoom.js"></script>
    <script src="/vendor/jquery.countdown/jquery.countdown.min.js"></script>

    <!-- Main JS -->
    <script src="/js/main.min.js"></script>
    <script src="/js/script.js"></script>
</body>

</html>